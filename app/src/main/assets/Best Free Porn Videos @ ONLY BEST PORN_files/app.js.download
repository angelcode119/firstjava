function setCookie(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+exdays*60*3*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/"}jQuery.event.special.touchstart={setup:function(_,ns,handle){this.addEventListener("touchstart",handle,{passive:!ns.includes("noPreventDefault")})}};jQuery.event.special.touchmove={setup:function(_,ns,handle){this.addEventListener("touchmove",handle,{passive:!ns.includes("noPreventDefault")})}};jQuery.event.special.wheel={setup:function(_,ns,handle){this.addEventListener("wheel",handle,{passive:true})}};jQuery.event.special.mousewheel={setup:function(_,ns,handle){this.addEventListener("mousewheel",handle,{passive:true})}};function decimalToHex(d,padding){var hex=Number(d).toString(16);padding=typeof padding==="undefined"||padding===null?padding=2:padding;while(hex.length<padding){hex="0"+hex}return hex}function getOffset(a){var b=0;if(a.offsetParent){do{b+=a.offsetTop}while(a=a.offsetParent);return b}}var videoPreviewUrl=document.body.dataset.trailer;var addListener=window.addEventListener||function(a,b){window.attachEvent("on"+a,b)};var removeListener=window.removeEventListener||function(a,b){window.detachEvent("on"+a,b)};$("body").on("click","[data-prev]",function(el){setCookie("fromThumb",$(this).attr("data-prev"),60)});function removeLazyAttribute(){let viewportHeight=window.innerHeight||document.documentElement.clientHeight;let threshold=window.scrollY+viewportHeight*2.5;let images=document.querySelectorAll('img[loading="lazy"]');for(let i=0;i<images.length;i++){let rect=images[i].getBoundingClientRect();if(rect.top<=threshold){images[i].removeAttribute("loading")}}}window.addEventListener("scroll",removeLazyAttribute);var isToTop=false;var toTop=document.getElementById("totop");toTop.style.display="none";document.getElementById("totop").onclick=function(){scrollToTop(50)};document.addEventListener("scroll",function(){document.documentElement.scrollTop>500?toTop.style.display="block":toTop.style.display="none"});function scrollToTop(scrollDuration){var scrollStep=-window.scrollY/(scrollDuration/15),scrollInterval=setInterval(function(){if(window.scrollY!=0){isToTop=true;window.scrollBy(0,scrollStep)}else{clearInterval(scrollInterval);isToTop=false}},15)}var elems=[];var o1=document.querySelectorAll(".show_menu");var o2=document.querySelectorAll(".menu_close");elems.push(o1);elems.push(o2);var holder=document.querySelector(".menu_holder");elems.forEach(function(o3){o3.forEach(function(elem){elem.addEventListener("click",function(e){e.preventDefault();holder.classList.toggle("open")},true)})});var rotatorMulty=document.querySelector("body").getAttribute("data-one-multy");var rotatorAction=document.querySelector("body").getAttribute("data-rotator");if(rotatorMulty!=null){document.querySelectorAll(".objectDetect").forEach(function(elem){elem.addEventListener("mousedown",function(e){var clickedId=elem.getAttribute("data-id-obj");var sendString="";document.querySelectorAll(".alreadyShowedObj").forEach(function(elem){if(!elem.classList.contains("adv_done")){elem.classList.add("adv_done");sendString+=elem.getAttribute("data-id-obj")+","}});var objectFromId=document.querySelector("body").getAttribute("data");if(rotatorMulty=="cats")objectFromId=objectFromId.replaceAll("cat","");else if(rotatorMulty=="related_videos")objectFromId=objectFromId.replaceAll("vid","");sendString=sendString+"|"+objectFromId+"|"+clickedId;if(sendString!=""){var url=location.protocol+"//"+window.location.hostname+"/click";var img=new Image;img.src=url+(url.indexOf("?")>=0?"&":"?")+"mode=async&action=rt_one_multi&pqr="+sendString+"&type="+rotatorMulty}})})}var domain=document.domain;var my_url="//"+domain+"";var current_site=my_url,id_input="#wordinput",id_list="#worddiv",formSearch="#search_form",oneElem=null,suggest_count=0,suggest_selected=0;var input=document.querySelector(id_input);var containter=document.querySelector(id_list);var form=document.querySelector(formSearch);var element=document.querySelector(id_list);form.addEventListener("submit",function(e){e.preventDefault()});var button_search=document.querySelector(".search-button");if(button_search!=null){button_search.addEventListener("click",function(e){e.preventDefault();s=current_site+"/find.php?q="+input.value;window.location=s;return false})}element.onmousedown=function(event){event.preventDefault();if(!oneElem.classList.contains("elem"))oneElem=oneElem.parentElement;var link=oneElem.getAttribute("data-link");window.location=current_site+"/"+link+"/";return false};element.onmouseover=function(event){event.target.classList.add("active");oneElem=event.target};element.onmouseout=function(event){event.target.classList.remove("active");oneElem=null};var timer=null;input.addEventListener("keyup",function(e){if(input.value!=""){clearTimeout(timer);timer=setTimeout(function(){var event=e;if(event.defaultPrevented){return}var key=event.key||event.keyCode;switch(e.keyCode){case"Enter":case"enter":case 13:e.preventDefault();if(oneElem==null)s=current_site+"/find.php?q="+input.value;else{if(!oneElem.classList.contains("elem"))oneElem=oneElem.parentElement;var t=oneElem.innerHTML.replace(/<\/?[^>]+(>|$)/g,""),s=current_site+"/find.php?q="+t}window.location=s;break;case 27:case"esc":case"Esc":e.preventDefault();containter.style.display="none";default:var params="keyword="+input.value;callAjax(current_site+"/find/auto-complete.php?"+params,function(response){containter.innerHTML="";var t=JSON.parse(response);suggest_count=t.length,suggest_selected=0,t.forEach(function(element){var pieces=input.value.split(" ");var outputWords=element.title.split(" ");for(j=0;j<pieces.length;j++){for(k=0;k<outputWords.length;k++){if(outputWords[k].indexOf("<strong>")!==-1)continue;var str=pieces[j];var reg=new RegExp(str,"i");outputWords[k]=outputWords[k].replace(reg,function(str){return"<strong>"+str+"</strong>"})}}var outputHint=outputWords.join(" ");containter.innerHTML+='<div class="elem" data-link="'+element.url+'">'+outputHint+"</div>"})})}},300)}});input.addEventListener("keydown",function(e){var event=e;if(event.defaultPrevented){return}var key=event.key||event.keyCode;switch(e.keyCode){case"Enter":case"enter":case 13:e.preventDefault();if(oneElem==null)s=current_site+"/find.php?q="+input.value;else{var t=oneElem.innerHTML.replace(/<\/?[^>]+(>|$)/g,""),s=current_site+"/find.php?q="+t}window.location=s;break}});input.addEventListener("focus",function(e){containter.style.display="block"});input.addEventListener("blur",function(e){containter.style.display="none";$(".show_search").toggleClass("open")});function callAjax(url,callback){var xmlhttp;xmlhttp=new XMLHttpRequest;xmlhttp.open("GET",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){callback(xmlhttp.responseText)}};xmlhttp.send()}var close=document.querySelector(".clear_search");if(close!=null){close.addEventListener("click",function(event){document.getElementById("wordinput").value="";document.getElementById("wordinput").focus();close.style.display="none"});close.addEventListener("touchend",function(event){document.getElementById("wordinput").value="";document.getElementById("wordinput").focus();close.style.display="none"})}var findMobile=document.querySelector(".show_search");if(findMobile!=null){findMobile.addEventListener("click",function(event){document.getElementById("wordinput").focus()})}function addEvent(elem,event,fn){if(elem.addEventListener){elem.addEventListener(event,fn,false)}else{elem.attachEvent("on"+event,function(){return fn.call(elem,window.event)})}}addEvent(input,"focus",function(){var that=this;setTimeout(function(){that.selectionStart=that.selectionEnd=1e4},0)});var initPlayTrailerOnHover=function(){if(navigator.userAgent.indexOf("UCBrowser")==-1){function playTrailer(e,t){var n=e,i=n.find("video");i.length?i.get(0).play():setTimeout(function(){var endUrl=videoPreviewUrl+n.attr("data-preview");endUrl+="_vid.mp4";var e=$('<video muted loop playsinline src="'+endUrl+'">'),t=e.get(0);n.append(e),t.onerror=function(){console.log("video file not found!")};t.onsuspend=function(){t.play()}},t)}var hoverTimer;var disableEvents=false;$("body").on("click","[data-preview]",function(el){setCookie("lastViewed",$(this).attr("data-preview"),30)});$("body").on("mouseenter","[data-preview]",function(){if(!disableEvents){var $this=$(this);hoverTimer=setTimeout(function(){$this.addClass("hovered");playTrailer($this,0)},750)}}).on("mouseleave","[data-preview]",function(){if(!disableEvents){var $this=$(this);$("[data-preview]").removeClass("hovered");clearTimeout(hoverTimer);var $video=$this.find("video");if($video!=null){$("img").show();$video.remove()}$this.find("img").show()}});var lastElement=null;if(navigator.userAgent.indexOf("UCBrowser")===-1){$(window).on("scroll",function(){if(lastElement!=null){var windowScrollPositionTop=$(window).scrollTop();var windowScrollPositionBottom=$(window).scrollTop()+$(window).height();var blockPosition=lastElement.offset().top;if(blockPosition<windowScrollPositionTop-lastElement.outerHeight()*.3||blockPosition+lastElement.outerHeight()>windowScrollPositionBottom+.3*lastElement.outerHeight()){lastElement.removeClass("hovered");var $video=lastElement.find("video");if($video!=null){$video.remove()}$("img").show();lastElement=null}}});$("[data-preview]").each(function(){var timeoutTouch,longtouch;$(this).bind("touchstart",function(){disableEvents=true;timeoutTouch=setTimeout(function(){longtouch=true},250)}).bind("touchend",function(){if(longtouch){if(lastElement==null){var $this=$(this);$this.addClass("hovered");playTrailer($this,0);lastElement=$this}else{var $this=$(this);if(!$this.hasClass("hovered")){lastElement.removeClass("hovered");var $video=lastElement.find("video");if($video!=null){$video.remove()}$("img").show();$this.addClass("hovered");playTrailer($this,0);lastElement=$this}}}longtouch=false;clearTimeout(timeoutTouch)})})}}};$(".show_search").removeClass("open");var pauseKVS;var isStarted=false;$(document).ready(function(){pauseKVS=false;initPlayTrailerOnHover();var objectFromId=document.querySelector("body").getAttribute("data-one-multy");if(objectFromId=="related_videos"){checkPicture(".objectDetect","alreadyShowedObj","item_a")}else{checkPicture(".lazyload","alreadyShowed","item_a");checkPicture(".objectDetect","alreadyShowedObj","")}});$(window).on("scroll",function(){var objectFromId=document.querySelector("body").getAttribute("data-one-multy");if(objectFromId=="related_videos"){checkPicture(".objectDetect","alreadyShowedObj","item_a")}else{checkPicture(".lazyload","alreadyShowed","item_a");checkPicture(".objectDetect","alreadyShowedObj","")}});function checkPicture(selector,classToAdd,whiteClass){var windowScrollPosition=$(window).scrollTop()+$(window).height();$(selector).each(function(index,element){var link=$(element);if((link.hasClass(whiteClass)||whiteClass=="")&&!link.hasClass(classToAdd)){var blockPosition=link.offset().top+link.outerHeight();if(blockPosition<windowScrollPosition){$(element).addClass(classToAdd)}}})}function idKey(id){if((i=id.indexOf("#"))!=-1){id=id.substring(0,i)}return parseInt(id,36)}function compactIntMap(idArray){idArray.sort((a,b)=>idKey(a)-idKey(b));let prevKey=0;return idArray.map(id=>{let n,i;if((i=id.indexOf("#"))!=-1){n=parseInt(id.substring(0,i));i=parseInt(id.substring(i+1))}else{n=parseInt(id);i=0}let diff=n-prevKey;prevKey=n;diff=diff.toString(36);return diff+(i>0?"!"+i.toString(36):"")}).join(",")}(()=>{const debug=localStorage.getItem("debug")==="true"?{log:console.log,error:console.error}:{log:()=>{},error:()=>{}};let ajaxElement,dataset,itemsContainerId,itemsContainer,paginationContainer,url,page;function initializeAjax(){ajaxElement=document.querySelector('[data-action="ajax"]');if(!ajaxElement){debug.error("Missing AJAX element for video list");return}dataset=ajaxElement.dataset;itemsContainerId=dataset.appendItemsTo||`${blockContainerId}_items`;itemsContainer=document.getElementById(itemsContainerId);const paginationContainerId=dataset.containerId||`${blockContainerId}_pagination`;paginationContainer=document.getElementById(paginationContainerId);if(!(itemsContainer&&paginationContainer)){debug.error("Missing containers for video list");return}let parameters=Object.fromEntries((dataset.parameters||"").split(";").map(p=>p.split(":")));if(dataset.currentQueries){page=parseInt(dataset.currentQueries)}else if(parameters["from"]){page=parseInt(parameters["from"])-1}debug.log("ajaxElement:",ajaxElement);url=ajaxElement.href;const clickHandler=e=>{e.preventDefault();performAjaxUpdate()};ajaxElement.addEventListener("click",clickHandler);ajaxElement.querySelectorAll("a[href]").forEach(a=>a.addEventListener("click",clickHandler))}let isLoadingItems=false;let loadedUrls=new Set;function performAjaxUpdate(){if(!ajaxElement){debug.error("Missing AJAX element for video list");return}if(!url||url===""){debug.error("Missing URL for video list");return}if(isLoadingItems)return;isLoadingItems=true;let parameters=Object.fromEntries((dataset.parameters||"").split(";").map(p=>p.split(":")));let nextPage;if(dataset.currentQueries){nextPage=parseInt(dataset.currentQueries)+1}else if(parameters["from"]){nextPage=parseInt(parameters["from"])}else{nextPage=1}if(nextPage<=parseInt(dataset.maxQueries||1)+1){Object.assign(parameters,{mode:"async",function:"get_block",block_id:dataset.blockId});parameters["from"]=nextPage;let simpleUrl=`${url}?${Object.entries(parameters).map(e=>encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])).join("&")}`;parameters["_"]=Date.now();let queryUrl=`${url}?${Object.entries(parameters).map(e=>encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])).join("&")}`;if(loadedUrls.has(simpleUrl)){isLoadingItems=false;return}fetch(queryUrl).then(response=>response.text()).then(html=>{loadedUrls.add(simpleUrl);const parser=new DOMParser;const doc=parser.parseFromString(html,"text/html");const newPagination=doc.getElementById(dataset.containerId||`${blockContainerId}_pagination`);const newItemsContainer=doc.getElementById(itemsContainerId);Array.from(newItemsContainer.children).forEach(node=>{node.parentElement.removeChild(node);itemsContainer.appendChild(node)});page=nextPage;if(!newPagination){paginationContainer.parentElement.removeChild(paginationContainer)}else if(paginationContainer.outerHTML!==newPagination.outerHTML){paginationContainer.outerHTML=newPagination.outerHTML;initializeAjax()}dataset.currentQueries=nextPage;initPlayTrailerOnHover();if(window.updateBanners){window.updateBanners()}if(window.hptRdr){window.hptRdr.update()}if(nextPage+1>dataset.maxQueries&&paginationContainer.parentElement){paginationContainer.parentElement.removeChild(paginationContainer)}}).catch(error=>{debug.error("Failed to load more videos. Error:",error)}).finally(()=>{isLoadingItems=false})}else{isLoadingItems=false}}function checkScrollPosition(){const itemsContainerRect=itemsContainer.getBoundingClientRect();const scrollPosition=window.scrollY;const windowInnerHeight=window.innerHeight;const threshold=scrollPosition+itemsContainerRect.bottom-windowInnerHeight*.5;if(scrollPosition+windowInnerHeight>threshold){performAjaxUpdate()}}initializeAjax();if(ajaxElement&&ajaxElement.classList.contains("infinitely_link")){let breakpoint=dataset.breakpoint!==undefined?parseInt(dataset.breakpoint):5;window.addEventListener("scroll",e=>{let currentPage=page||0;if(breakpoint<=0||currentPage%breakpoint!==breakpoint){checkScrollPosition()}})}})();(()=>{const reportUrl="/rttr.php";const trackedSelector="a[data-rt]";const viewedVideoIds=new Set;const clickedVideoIds=new Set;let visibleElementsCheckTimeout=null;let pendingEvents=[];function parseRotationId(rotationId){const[position,matrix,screen,videoId,page,context]=rotationId.split(":");return{page:parseInt(page),matrix:matrix,position:parseInt(position),screen:parseInt(screen),videoId:videoId,context:context||""}}function handleEvent(type,rotationId){const now=Date.now();const{position,matrix,screen,videoId,page,context}=parseRotationId(rotationId);pendingEvents.push({type:type,rotationId:rotationId,screen:screen,time:now})}function sendPendingEvents(){if(pendingEvents.length){const blob=new Blob([JSON.stringify(pendingEvents)],{type:"application/json"});pendingEvents=[];if(navigator.sendBeacon){navigator.sendBeacon(reportUrl,blob)}else{fetch(reportUrl,{method:"POST",body:blob,keepalive:true}).catch(()=>{})}}}function extractId(element){const tracked=element.closest(trackedSelector);if(!tracked)return null;const rotationId=tracked.dataset.rt;if(!rotationId)return null;const rotationIdSign=tracked.dataset.rtS;if(!rotationIdSign)return null;const img=tracked.querySelector("img[src]");if(!img)return null;const match=/\/(\d+)\/(\d+)\/(\d+)\.jpg$/.exec(img.src);if(!match)return null;const parts=rotationId.split(":");parts[2]=match[3];return parts.join(":")+":"+rotationIdSign}function isInViewport(element){const rect=element.getBoundingClientRect();return rect.width>0&&rect.height>0&&rect.bottom>=0&&rect.right>=0&&rect.top<=(window.innerHeight||document.documentElement.clientHeight)&&rect.left<=(window.innerWidth||document.documentElement.clientWidth)}function checkVisibleElements(){document.querySelectorAll(trackedSelector).forEach(elem=>{const videoId=extractId(elem);if(videoId&&!viewedVideoIds.has(videoId)&&isInViewport(elem)){viewedVideoIds.add(videoId);handleEvent("view",videoId)}})}function scheduleVisibleElementsCheck(){if(visibleElementsCheckTimeout){clearTimeout(visibleElementsCheckTimeout)}visibleElementsCheckTimeout=setTimeout(checkVisibleElements,500)}function handleClick(event){let elem=event.target;while(elem&&elem!==document){if(elem.matches(trackedSelector)){const videoId=extractId(elem);if(videoId&&viewedVideoIds.has(videoId)&&!clickedVideoIds.has(videoId)){clickedVideoIds.add(videoId);handleEvent("click",videoId);sendPendingEvents()}return}elem=elem.parentElement}}window.addEventListener("scroll",scheduleVisibleElementsCheck,{passive:true});window.addEventListener("resize",scheduleVisibleElementsCheck,{passive:true});document.addEventListener("click",handleClick);window.addEventListener("load",checkVisibleElements);["visibilitychange","pagehide","beforeunload"].forEach(event=>{window.addEventListener(event,sendPendingEvents)});setInterval(sendPendingEvents,5e3)})();
